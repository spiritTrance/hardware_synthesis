# hardware_synthesis

- 替换step_into_mips_lab4_rtl下的文件

# 工作日志（？）

## 2023/1/1

- TODO：逻辑运算指令，把controller整合进datapath中
- 需要用到的资料：计组实验四的数据通路图，视频所给的参考代码，vivado下的README，硬综文档

错误记录：

1.在做逻辑移位运算时，修改后仿真波形图不能读取指令。经过排查，发现一个控制信号为高阻态Z，怀疑是某个地方未连线，于是按照连接逻辑添加波形，最后发现是一个触发器的flop在复位时就是高阻态，发现是触发器前面的可选参数位宽#()未更改，但ALU控制信号从计组的两位扩展到五位，导致没有连上。

## 2023/1/2

- 加入逻辑运算指令和移位指令（8+6）
- 看了HI和LO相关的数据移动指令，以及乘除法相关原理
- 将控制模块整合进datapath，mips模块相当于datapath的wrappper

错误记录：

在做算术移位时，使用>>>仍然没有做到有符号扩展。经过查阅资料，发现需要用系统函数$signed()表明相应数为有符号数。

## 2023/1/3

- 完成数据移位指令
  - 存在的疑问是，hiloreg前面的控制信号应该放在哪？这里采用的是E阶段的控制信号，原因是，如果用M的，那么相当于插了一级的流水线，时序可能出现问题，但不知道有没有bug，会不会是关键路径，先留着看看
- 加入运算指令
  - 但是没加成功，发现乘法不对，排查后发现是操作数因为前面停后面不停，加上前推逻辑导致跳变的问题。改为流水线一停全停的逻辑，发现还是有跳变，排查后发现是某个控制信号在跳变，经过检查，发现是controller还有部分流水线没有改。
  - 现在还有的问题是hi和lo没改，数据移位指令貌似在regfile里面写入了不该写的东西，然后除法还有问题？明天再看
  - 刚写完发现div模块用得不对，改出来了，但是HI和LO还是有问题，而且写进regfile了，明天再看

## 2023/1/4

考虑以下序列，是否会发生冒险：

```
# case 1
mfhi $2
mthi $2
mfhi $2
# case 2
mul $zero, $1, $2
mfhi $1
div $2, $1
```

在后期可能会引发bug，以及在原来的前推逻辑中，会不会引发错误的前推？会的，主要是mfxx指令引发的，解决方案是把hilo信号写进alu中，由aluoutM送出来，这样就可以不用更改之前的hazard逻辑。但现在的话，alu需要大改= =
